// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum Role {
  SUPERADMIN
  SUPERVISOR
  EMPLOYEE
}

enum EmploymentType {
  PERMANENT
  TEMPORARY
  FORMER
}

enum PayrollStatus {
  PROCESSED // TODO: Add other statuses when workflow is defined
}

model User {
  id                      Int            @id @default(autoincrement())
  fullName                String
  email                   String         @unique
  password                String
  phoneNumber             String?
  roleName                String?
  role                    Role
  employmentType          EmploymentType
  taxNumber               String?
  identityNumber          String?
  startDate               DateTime?
  leaveDate               DateTime?
  location                String?
  bankNumber              String?
  bankName                String?
  bankAccountHolderName   String?
  photoUrl                String?
  organizationId          Int?
  organization            Organization?  @relation(fields: [organizationId], references: [id], onDelete: SetNull)
  supervisedOrganizations Organization[] @relation("OrganizationSupervisor")
  createdAt               DateTime       @default(now())
  updatedAt               DateTime       @updatedAt
  payrolls                Payroll[]

  @@index([organizationId])
  @@index([email])
}

model Organization {
  id           Int      @id @default(autoincrement())
  name         String
  supervisorId Int
  supervisor   User     @relation("OrganizationSupervisor", fields: [supervisorId], references: [id], onDelete: Restrict)
  members      User[]
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  @@index([supervisorId])
}

model Payroll {
  id              Int           @id @default(autoincrement())
  userId          Int
  user            User          @relation(fields: [userId], references: [id], onDelete: Cascade)
  month           Int
  year            Int
  baseSalary      Decimal
  allowance       Decimal?      @default(0)
  bonuses         Decimal?      @default(0)
  tax             Decimal?      @default(0)
  insurance       Decimal?      @default(0)
  pensionFund     Decimal?      @default(0)
  otherDeductions Decimal?      @default(0)
  status          PayrollStatus @default(PROCESSED)
  createdAt       DateTime      @default(now())
  updatedAt       DateTime      @updatedAt

  @@unique([userId, month, year])
  @@index([userId])
}
